---
title: "Introduction to tidyr, dply and ggvis"
author: "Rob Hayward"
date: "Thursday, August 28, 2014"
output: html_document
---
#Tidy and dplyr from HW
This comes from [R-Studio video.  ](http://pages.rstudio.net/Webinar-Series-Recording-Essential-Tools-for-R.html?mkt_tok=3RkMMJWWfF9wsRonuqzMZKXonjHpfsX56uovXKO2lMI%2F0ER3fOvrPUfGjI4ATMFlI%2BSLDwEYGJlv6SgFTbDMMa541LgKWxc%3D)
Not sure how long this will last. The first part is about the package ```tidyr```.  The three main commands are **gather**, **spread** and **separate**.  There is a 30-page document about *tidy data*.   There can be a link between ```tidyr``` and ```dplyr``` and ```ggvis```.  
 
The process of data analysis has three stages:  think it, describe it and do it. The commands for dplyr

* filter:  keep rows matching criteria
* select: pick columns by name
* arrange: reorder rows
* mutate: add new vaiables
* summarise: reduce varibles to vaules

This reduceds the **thinking** part of the data analysis. 


For the presentation of data use ```ggvis```.  This can flow from *The Grammer of Graphics*. There are links between ```ggplot2``` and ```ggvis```.  All the data are available in [github.](https://github.com/rstudio/webinars)  
#'dplyr intro from Rstudio
This comes from [R-Studio.](http://blog.rstudio.org/2014/01/17/introducing-dplyr/). The aim is to draw the list of baseball players with the most games. 
```{r, message=FALSE, warning=FALSE}
library(Lahman)
library(dplyr)
players <- group_by(Batting, playerID)
games <- summarise(players, total = sum(G))
head(arrange(games, desc(total)), 5)
```
Operations can be chained together with the ```%.%``` operator. For example, 
```{r}
Batting %.%
  group_by(playerID) %.%
  summarise(total = sum(G)) %.%
  arrange(desc(total))%.%
  head(5)
```
From the introductory vignette that can be accessed by ```vignette("introduction", package = "dplyr")```




##Video overview
This is the video from [R-videos](http://practicalrvideos.blogspot.co.uk/2014/08/dplyr-gamechanger-for-data-manipulation.html)

Load the Titanic data.

```{r, message=FALSE, warning=FALSE}
library(ggplot2)
train = read.csv("../../Data/train.csv")
head(train)
```
key functions in dplyr

* *select:* select columns from a dataframe
* *filter:* select rows from a data frame based upon criteria
* *group_by:* group by a factor variable
* *summarize:* allows you to do summary stats based upon the grouped variable
* *arrange:*  a better way to order the data set

### Selecting columns and rows of a dataframe 
Selecting columns
```{r}
VariablesThatICareAbout = select(train, Survived, Pclass, Sex, Age, SibSp, Parch, Fare) 
head(VariablesThatICareAbout)
```
Everything except for PassengerId:
```{r}
VariablesThatICareAbout = select(train, -PassengerId) 
head(VariablesThatICareAbout)
```
Columns Survived to Age
```{r}
VariablesThatICareAbout = select(train, Survived:Age) 
head(VariablesThatICareAbout)
```

Selecting rows: only first class passengers
```{r}
FirstClass = filter(train, Pclass == 1)
head(FirstClass)
```
Only first class male passengers
```{r}
FirstClass = filter(train, Pclass == 1 & Sex == "male")
head(FirstClass)
```

Ordering the rows by fare and then class.  To switch round the put ```-Fare```
```{r}
train = arrange(train, Fare, Pclass)
head(train)
```


###Multiple commands in a single step 
The main value is the ability to pipe the output from one command into another
use ```%>%``` to pipe one command into another.  This means that the ```select``` statement will be piped into the ```group-by``` statement and that will be piped into the ```summarize``` statement. 


Average fare by passenger class
```{r}
select(train, Pclass, Fare, Survived) %>%
  group_by(Pclass) %>% #don't have to specify the dataset a second time
  summarize(AvgFare = mean(Fare), ProbSurvived = mean(Survived), N = length(Fare))
```

Just change the ```group-by``` statement to look at the survival by sex.
```{r}
select(train, Sex, Survived) %>%
  group_by(Sex) %>%
  summarize(ProbSurvived = mean(Survived))
```
Both categories at the same time!
(group by two variables)
```{r}
A = select(train, Pclass, Sex, Fare, Survived) %>%
  group_by(Pclass, Sex) %>% #don't have to specify the dataset a second time
  summarize(AvgFare = mean(Fare), ProbSurvived = mean(Survived), N = length(Fare))
A
```

Variable creation 
Use the mutate function
```{r}
train = mutate(train
               , AgeByFare = Age * Fare
               , Age2 = Age^2)
#allows you to create variables in one step 
#without specifying the data frame a bunch of times
train$Age2 = train$Age^2
```

  ### ggplot teaser 
There will be another tutorial on ggplot
Just wanted to show this to motivate using ggplot!
dplyr makes it easier to produce grouped plots in ggplot
```{r}
ggplot(A, aes(x = Pclass, y = ProbSurvived)) + 
  geom_point(aes(size = N)) + 
  geom_line(aes(by = Sex, color = Sex))
```
Survival probability unaffected for male 2 or 3 class, 
but big difference for females in 2nd and 3rd class
